import React, { useState } from 'react';
import AnimateHeight from 'react-animate-height';
import { Draggable } from 'react-beautiful-dnd';
import ActionPanel from './ActionPanel';
import SectionTitle from './SectionTitle';
import PositionPanel from './PositionPanel';
import Button from '../../elements/Button';
import { NegativeFieldGutterProvider } from '../FieldTypeGutter/context';
import FieldTypeGutter from '../FieldTypeGutter';
import RenderFields, { useRenderedFields } from '../RenderFields';
import './index.scss';
const baseClass = 'draggable-section';
const DraggableSection = (props) => {
    const { moveRow, addRow, removeRow, rowIndex, rowCount, parentPath, fieldSchema, label, blockType, fieldTypes, toggleRowCollapse, id, permissions, isOpen, readOnly, hasMaxRows, } = props;
    const [isHovered, setIsHovered] = useState(false);
    const { operation } = useRenderedFields();
    const classes = [
        baseClass,
        isOpen ? 'is-open' : 'is-closed',
        (isHovered && !readOnly) && 'is-hovered',
    ].filter(Boolean).join(' ');
    return (React.createElement(Draggable, { draggableId: id, index: rowIndex, isDragDisabled: readOnly }, (providedDrag) => (React.createElement("div", Object.assign({ ref: providedDrag.innerRef, className: classes, onMouseLeave: () => setIsHovered(false), onMouseOver: () => setIsHovered(true), onFocus: () => setIsHovered(true) }, providedDrag.draggableProps),
        React.createElement("div", { className: `${baseClass}__content-wrapper` },
            React.createElement(FieldTypeGutter, { variant: "left", dragHandleProps: providedDrag.dragHandleProps },
                React.createElement(PositionPanel, { moveRow: moveRow, rowCount: rowCount, positionIndex: rowIndex })),
            React.createElement("div", { className: `${baseClass}__render-fields-wrapper` },
                blockType === 'blocks' && (React.createElement("div", { className: `${baseClass}__section-header` },
                    React.createElement(SectionTitle, { label: label, path: `${parentPath}.${rowIndex}.blockName`, readOnly: readOnly }),
                    React.createElement(Button, { icon: "chevron", onClick: () => toggleRowCollapse(rowIndex), buttonStyle: "icon-label", className: `toggle-collapse toggle-collapse--is-${isOpen ? 'open' : 'closed'}`, round: true }))),
                React.createElement(AnimateHeight, { height: isOpen ? 'auto' : 0, duration: 0 },
                    React.createElement(NegativeFieldGutterProvider, { allow: false },
                        React.createElement(RenderFields, { operation: operation, readOnly: readOnly, fieldTypes: fieldTypes, key: rowIndex, permissions: permissions?.fields, fieldSchema: fieldSchema.map((field) => ({
                                ...field,
                                path: `${parentPath}.${rowIndex}${field.name ? `.${field.name}` : ''}`,
                            })) })))),
            React.createElement(FieldTypeGutter, { variant: "right", className: "actions", dragHandleProps: providedDrag.dragHandleProps }, !readOnly && (React.createElement(ActionPanel, Object.assign({ addRow: addRow, removeRow: removeRow, rowIndex: rowIndex, label: label, isHovered: isHovered, hasMaxRows: hasMaxRows }, props)))))))));
};
export default DraggableSection;
