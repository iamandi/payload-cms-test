"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const errors_1 = require("../../errors");
const sanitize_1 = __importDefault(require("../../fields/config/sanitize"));
const sanitizeGlobals = (collections, globals) => {
    // /////////////////////////////////
    // Ensure globals are valid
    // /////////////////////////////////
    globals.forEach((globalConfig) => {
        if (!globalConfig.label) {
            throw new errors_1.MissingGlobalLabel(globalConfig);
        }
    });
    const sanitizedGlobals = globals.map((global) => {
        const sanitizedGlobal = { ...global };
        // /////////////////////////////////
        // Ensure that collection has required object structure
        // /////////////////////////////////
        if (!sanitizedGlobal.hooks)
            sanitizedGlobal.hooks = {};
        if (!sanitizedGlobal.access)
            sanitizedGlobal.access = {};
        if (!sanitizedGlobal.admin)
            sanitizedGlobal.admin = {};
        if (!sanitizedGlobal.hooks.beforeValidate)
            sanitizedGlobal.hooks.beforeValidate = [];
        if (!sanitizedGlobal.hooks.beforeChange)
            sanitizedGlobal.hooks.beforeChange = [];
        if (!sanitizedGlobal.hooks.afterChange)
            sanitizedGlobal.hooks.afterChange = [];
        if (!sanitizedGlobal.hooks.beforeRead)
            sanitizedGlobal.hooks.beforeRead = [];
        if (!sanitizedGlobal.hooks.afterRead)
            sanitizedGlobal.hooks.afterRead = [];
        // /////////////////////////////////
        // Sanitize fields
        // /////////////////////////////////
        const validRelationships = collections.map((c) => c.slug);
        sanitizedGlobal.fields = sanitize_1.default(global.fields, validRelationships);
        return sanitizedGlobal;
    });
    return sanitizedGlobals;
};
exports.default = sanitizeGlobals;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2FuaXRpemUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZ2xvYmFscy9jb25maWcvc2FuaXRpemUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSx5Q0FBa0Q7QUFDbEQsNEVBQTBEO0FBRTFELE1BQU0sZUFBZSxHQUFHLENBQUMsV0FBVyxFQUFFLE9BQU8sRUFBRSxFQUFFO0lBQy9DLG9DQUFvQztJQUNwQywyQkFBMkI7SUFDM0Isb0NBQW9DO0lBRXBDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxZQUFZLEVBQUUsRUFBRTtRQUMvQixJQUFJLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRTtZQUN2QixNQUFNLElBQUksMkJBQWtCLENBQUMsWUFBWSxDQUFDLENBQUM7U0FDNUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO1FBQzlDLE1BQU0sZUFBZSxHQUFHLEVBQUUsR0FBRyxNQUFNLEVBQUUsQ0FBQztRQUV0QyxvQ0FBb0M7UUFDcEMsdURBQXVEO1FBQ3ZELG9DQUFvQztRQUVwQyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUs7WUFBRSxlQUFlLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUN2RCxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU07WUFBRSxlQUFlLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUN6RCxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUs7WUFBRSxlQUFlLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUV2RCxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxjQUFjO1lBQUUsZUFBZSxDQUFDLEtBQUssQ0FBQyxjQUFjLEdBQUcsRUFBRSxDQUFDO1FBQ3JGLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLFlBQVk7WUFBRSxlQUFlLENBQUMsS0FBSyxDQUFDLFlBQVksR0FBRyxFQUFFLENBQUM7UUFDakYsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsV0FBVztZQUFFLGVBQWUsQ0FBQyxLQUFLLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUMvRSxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxVQUFVO1lBQUUsZUFBZSxDQUFDLEtBQUssQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQzdFLElBQUksQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLFNBQVM7WUFBRSxlQUFlLENBQUMsS0FBSyxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUM7UUFFM0Usb0NBQW9DO1FBQ3BDLGtCQUFrQjtRQUNsQixvQ0FBb0M7UUFFcEMsTUFBTSxrQkFBa0IsR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUQsZUFBZSxDQUFDLE1BQU0sR0FBRyxrQkFBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUUzRSxPQUFPLGVBQWUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sZ0JBQWdCLENBQUM7QUFDMUIsQ0FBQyxDQUFDO0FBRUYsa0JBQWUsZUFBZSxDQUFDIn0=