"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const errors_1 = require("../../errors");
async function registerFirstUser(args) {
    const { collection: { Model, }, } = args;
    const count = await Model.countDocuments({});
    if (count >= 1)
        throw new errors_1.Forbidden();
    // /////////////////////////////////////
    // Register first user
    // /////////////////////////////////////
    let result = await this.operations.collections.create({
        ...args,
        overrideAccess: true,
    });
    // /////////////////////////////////////
    // Log in new user
    // /////////////////////////////////////
    const { token } = await this.operations.collections.auth.login({
        ...args,
    });
    result = {
        ...result,
        token,
    };
    return {
        message: 'Registered and logged in successfully. Welcome!',
        user: result,
    };
}
exports.default = registerFirstUser;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVnaXN0ZXJGaXJzdFVzZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvYXV0aC9vcGVyYXRpb25zL3JlZ2lzdGVyRmlyc3RVc2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEseUNBQXlDO0FBRXpDLEtBQUssVUFBVSxpQkFBaUIsQ0FBQyxJQUFJO0lBQ25DLE1BQU0sRUFDSixVQUFVLEVBQUUsRUFDVixLQUFLLEdBQ04sR0FDRixHQUFHLElBQUksQ0FBQztJQUVULE1BQU0sS0FBSyxHQUFHLE1BQU0sS0FBSyxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUU3QyxJQUFJLEtBQUssSUFBSSxDQUFDO1FBQUUsTUFBTSxJQUFJLGtCQUFTLEVBQUUsQ0FBQztJQUV0Qyx3Q0FBd0M7SUFDeEMsc0JBQXNCO0lBQ3RCLHdDQUF3QztJQUV4QyxJQUFJLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQztRQUNwRCxHQUFHLElBQUk7UUFDUCxjQUFjLEVBQUUsSUFBSTtLQUNyQixDQUFDLENBQUM7SUFHSCx3Q0FBd0M7SUFDeEMsa0JBQWtCO0lBQ2xCLHdDQUF3QztJQUV4QyxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQzdELEdBQUcsSUFBSTtLQUNSLENBQUMsQ0FBQztJQUVILE1BQU0sR0FBRztRQUNQLEdBQUcsTUFBTTtRQUNULEtBQUs7S0FDTixDQUFDO0lBRUYsT0FBTztRQUNMLE9BQU8sRUFBRSxpREFBaUQ7UUFDMUQsSUFBSSxFQUFFLE1BQU07S0FDYixDQUFDO0FBQ0osQ0FBQztBQUVELGtCQUFlLGlCQUFpQixDQUFDIn0=