"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
/* eslint-disable no-await-in-loop */
/* eslint-disable no-restricted-syntax */
/* eslint-disable no-use-before-define */
const graphql_type_json_1 = require("graphql-type-json");
const graphql_1 = require("graphql");
const graphql_scalars_1 = require("graphql-scalars");
const types_1 = require("../../fields/config/types");
const formatName_1 = __importDefault(require("../utilities/formatName"));
const combineParentName_1 = __importDefault(require("../utilities/combineParentName"));
const withNullableType_1 = __importDefault(require("./withNullableType"));
function buildObjectType(name, fields, parentName, baseFields = {}) {
    const recursiveBuildObjectType = buildObjectType.bind(this);
    const fieldToSchemaMap = {
        number: (field) => ({ type: withNullableType_1.default(field, graphql_1.GraphQLFloat) }),
        text: (field) => ({ type: withNullableType_1.default(field, graphql_1.GraphQLString) }),
        email: (field) => ({ type: withNullableType_1.default(field, graphql_scalars_1.EmailAddressResolver) }),
        textarea: (field) => ({ type: withNullableType_1.default(field, graphql_1.GraphQLString) }),
        richText: (field) => ({ type: withNullableType_1.default(field, graphql_type_json_1.GraphQLJSON) }),
        code: (field) => ({ type: withNullableType_1.default(field, graphql_1.GraphQLString) }),
        date: (field) => ({ type: withNullableType_1.default(field, graphql_scalars_1.DateTimeResolver) }),
        upload: (field) => {
            const { relationTo, label } = field;
            const uploadName = combineParentName_1.default(parentName, label);
            // If the relationshipType is undefined at this point,
            // it can be assumed that this blockType can have a relationship
            // to itself. Therefore, we set the relationshipType equal to the blockType
            // that is currently being created.
            const type = this.collections[relationTo].graphQL.type || newlyCreatedBlockType;
            const uploadArgs = {};
            if (this.config.localization) {
                uploadArgs.locale = {
                    type: this.types.localeInputType,
                };
                uploadArgs.fallbackLocale = {
                    type: this.types.fallbackLocaleInputType,
                };
            }
            const relatedCollectionSlug = field.relationTo;
            const relatedCollection = this.collections[relatedCollectionSlug];
            const { find } = this.operations.collections;
            const upload = {
                args: uploadArgs,
                type,
                extensions: { complexity: 20 },
                async resolve(parent, args, context) {
                    const value = parent[field.name];
                    const locale = args.locale || context.locale;
                    const fallbackLocale = args.fallbackLocale || context.fallbackLocale;
                    let id = value;
                    if (id) {
                        id = id.toString();
                        const relatedDocumentQuery = {
                            collection: relatedCollection,
                            where: {
                                ...(args.where || {}),
                                _id: {
                                    equals: id,
                                },
                            },
                            req: {
                                ...context,
                                locale,
                                fallbackLocale,
                            },
                            depth: 0,
                        };
                        const relatedDocument = await find(relatedDocumentQuery);
                        if (relatedDocument.docs[0])
                            return relatedDocument.docs[0];
                        return null;
                    }
                    return null;
                },
            };
            const whereFields = this.collections[relationTo].config.fields;
            upload.args.where = {
                type: this.buildWhereInputType(uploadName, whereFields, uploadName),
            };
            return upload;
        },
        radio: (field) => ({
            type: withNullableType_1.default(field, new graphql_1.GraphQLEnumType({
                name: combineParentName_1.default(parentName, field.name),
                values: field.options.reduce((values, option) => {
                    if (types_1.optionIsObject(option)) {
                        return {
                            ...values,
                            [formatName_1.default(option.value)]: {
                                value: option.value,
                            },
                        };
                    }
                    return {
                        ...values,
                        [formatName_1.default(option)]: {
                            value: option,
                        },
                    };
                }, {}),
            })),
        }),
        checkbox: (field) => ({ type: withNullableType_1.default(field, graphql_1.GraphQLBoolean) }),
        select: (field) => {
            const fullName = combineParentName_1.default(parentName, field.name);
            let type = new graphql_1.GraphQLEnumType({
                name: fullName,
                values: field.options.reduce((values, option) => {
                    if (typeof option === 'object' && option.value) {
                        return {
                            ...values,
                            [formatName_1.default(option.value)]: {
                                value: option.value,
                            },
                        };
                    }
                    if (typeof option === 'string') {
                        return {
                            ...values,
                            [formatName_1.default(option)]: {
                                value: option,
                            },
                        };
                    }
                    return values;
                }, {}),
            });
            type = field.hasMany ? new graphql_1.GraphQLList(type) : type;
            type = withNullableType_1.default(field, type);
            return { type };
        },
        relationship: (field) => {
            const { relationTo, label } = field;
            const isRelatedToManyCollections = Array.isArray(relationTo);
            const hasManyValues = field.hasMany;
            const relationshipName = combineParentName_1.default(parentName, label);
            let type;
            let relationToType = null;
            if (Array.isArray(relationTo)) {
                relationToType = new graphql_1.GraphQLEnumType({
                    name: `${relationshipName}_RelationTo`,
                    values: relationTo.reduce((relations, relation) => ({
                        ...relations,
                        [formatName_1.default(relation)]: {
                            value: relation,
                        },
                    }), {}),
                });
                const types = relationTo.map((relation) => this.collections[relation].graphQL.type);
                let resolveType = function resolveType(data) {
                    return this.collections[data.collection].graphQL.type;
                };
                resolveType = resolveType.bind(this);
                type = new graphql_1.GraphQLObjectType({
                    name: `${relationshipName}_Relationship`,
                    fields: {
                        relationTo: {
                            type: relationToType,
                        },
                        value: {
                            type: new graphql_1.GraphQLUnionType({
                                name: relationshipName,
                                types,
                                resolveType,
                            }),
                        },
                    },
                });
            }
            else {
                ({ type } = this.collections[relationTo].graphQL);
            }
            // If the relationshipType is undefined at this point,
            // it can be assumed that this blockType can have a relationship
            // to itself. Therefore, we set the relationshipType equal to the blockType
            // that is currently being created.
            type = type || newlyCreatedBlockType;
            const relationshipArgs = {};
            if (this.config.localization) {
                relationshipArgs.locale = {
                    type: this.types.localeInputType,
                };
                relationshipArgs.fallbackLocale = {
                    type: this.types.fallbackLocaleInputType,
                };
            }
            const { collections, operations: { collections: { find, }, }, } = this;
            const relationship = {
                args: relationshipArgs,
                type: hasManyValues ? new graphql_1.GraphQLList(type) : type,
                extensions: { complexity: 10 },
                async resolve(parent, args, context) {
                    const value = parent[field.name];
                    const locale = args.locale || context.locale;
                    const fallbackLocale = args.fallbackLocale || context.fallbackLocale;
                    let relatedCollectionSlug = field.relationTo;
                    if (hasManyValues) {
                        const results = [];
                        const resultPromises = [];
                        const createPopulationPromise = async (relatedDoc) => {
                            let id = relatedDoc;
                            if (isRelatedToManyCollections) {
                                relatedCollectionSlug = relatedDoc.relationTo;
                                id = relatedDoc.value;
                            }
                            const result = await find({
                                collection: collections[relatedCollectionSlug],
                                where: {
                                    ...(args.where || {}),
                                    _id: {
                                        equals: id,
                                    },
                                },
                                res: context.res,
                                req: {
                                    ...context.req,
                                    locale,
                                    fallbackLocale,
                                },
                                depth: 0,
                            });
                            if (result.docs.length === 1) {
                                if (isRelatedToManyCollections) {
                                    results.push({
                                        relationTo: relatedCollectionSlug,
                                        value: {
                                            ...result.docs[0],
                                            collection: relatedCollectionSlug,
                                        },
                                    });
                                }
                                else {
                                    results.push(result.docs[0]);
                                }
                            }
                        };
                        if (value) {
                            value.forEach((relatedDoc) => {
                                resultPromises.push(createPopulationPromise(relatedDoc));
                            });
                        }
                        await Promise.all(resultPromises);
                        return results;
                    }
                    let id = value;
                    if (isRelatedToManyCollections && value) {
                        id = value.value;
                        relatedCollectionSlug = value.relationTo;
                    }
                    if (id) {
                        id = id.toString();
                        const relatedDocumentQuery = {
                            collection: collections[relatedCollectionSlug],
                            where: {
                                ...(args.where || {}),
                                id: {
                                    equals: id,
                                },
                            },
                            ...context,
                            depth: 0,
                        };
                        if (args.page)
                            relatedDocumentQuery.paginate.page = args.page;
                        if (args.limit)
                            relatedDocumentQuery.paginate.limit = args.limit;
                        const relatedDocument = await find(relatedDocumentQuery);
                        if (relatedDocument.docs[0]) {
                            if (isRelatedToManyCollections) {
                                return {
                                    relationTo: relatedCollectionSlug,
                                    value: {
                                        ...relatedDocument.docs[0],
                                        collection: relatedCollectionSlug,
                                    },
                                };
                            }
                            return relatedDocument.docs[0];
                        }
                        return null;
                    }
                    return null;
                },
            };
            if (hasManyValues) {
                relationship.args.page = { type: graphql_1.GraphQLInt };
                relationship.args.limit = { type: graphql_1.GraphQLInt };
            }
            if (Array.isArray(relationTo)) {
                const relatedCollectionFields = relationTo.reduce((allFields, relation) => [
                    ...allFields,
                    ...collections[relation].config.fields,
                ], []);
                relationship.args.where = {
                    type: this.buildWhereInputType(relationshipName, relatedCollectionFields, relationshipName),
                };
            }
            else {
                const whereFields = this.collections[relationTo].config.fields;
                relationship.args.where = {
                    type: this.buildWhereInputType(relationshipName, whereFields, relationshipName),
                };
            }
            return relationship;
        },
        array: (field) => {
            const fullName = combineParentName_1.default(parentName, field.label);
            let type = recursiveBuildObjectType(fullName, field.fields, fullName);
            type = new graphql_1.GraphQLList(withNullableType_1.default(field, type));
            return { type };
        },
        group: (field) => {
            const fullName = combineParentName_1.default(parentName, field.label);
            const type = recursiveBuildObjectType(fullName, field.fields, fullName);
            return { type };
        },
        blocks: (field) => {
            const blockTypes = field.blocks.map((block) => {
                this.buildBlockType(block);
                return this.types.blockTypes[block.slug];
            });
            const type = new graphql_1.GraphQLList(new graphql_1.GraphQLUnionType({
                name: combineParentName_1.default(parentName, field.label),
                types: blockTypes,
                resolveType: (data) => this.types.blockTypes[data.blockType],
            }));
            return { type };
        },
        row: (field) => field.fields.reduce((subFieldSchema, subField) => {
            const buildSchemaType = fieldToSchemaMap[subField.type];
            if (buildSchemaType) {
                return {
                    ...subFieldSchema,
                    [formatName_1.default(subField.name)]: buildSchemaType(subField),
                };
            }
            return subFieldSchema;
        }, {}),
    };
    const objectSchema = {
        name,
        fields: () => fields.reduce((schema, field) => {
            if (!field.hidden) {
                const fieldSchema = fieldToSchemaMap[field.type];
                if (fieldSchema) {
                    if (field.name) {
                        return {
                            ...schema,
                            [formatName_1.default(field.name)]: fieldSchema(field),
                        };
                    }
                    return {
                        ...schema,
                        ...fieldSchema(field),
                    };
                }
            }
            return schema;
        }, baseFields),
    };
    const newlyCreatedBlockType = new graphql_1.GraphQLObjectType(objectSchema);
    return newlyCreatedBlockType;
}
exports.default = buildObjectType;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGRPYmplY3RUeXBlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2dyYXBocWwvc2NoZW1hL2J1aWxkT2JqZWN0VHlwZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLHFDQUFxQztBQUNyQyx5Q0FBeUM7QUFDekMseUNBQXlDO0FBQ3pDLHlEQUFnRDtBQUNoRCxxQ0FTaUI7QUFDakIscURBQXlFO0FBQ3pFLHFEQUEySDtBQUMzSCx5RUFBaUQ7QUFDakQsdUZBQStEO0FBQy9ELDBFQUFrRDtBQWVsRCxTQUFTLGVBQWUsQ0FBQyxJQUFZLEVBQUUsTUFBZSxFQUFFLFVBQWtCLEVBQUUsYUFBeUIsRUFBRTtJQUNyRyxNQUFNLHdCQUF3QixHQUFHLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFNUQsTUFBTSxnQkFBZ0IsR0FBRztRQUN2QixNQUFNLEVBQUUsQ0FBQyxLQUFZLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsMEJBQWdCLENBQUMsS0FBSyxFQUFFLHNCQUFZLENBQUMsRUFBRSxDQUFDO1FBQzNFLElBQUksRUFBRSxDQUFDLEtBQVksRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSwwQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsdUJBQWEsQ0FBQyxFQUFFLENBQUM7UUFDMUUsS0FBSyxFQUFFLENBQUMsS0FBWSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLDBCQUFnQixDQUFDLEtBQUssRUFBRSxzQ0FBb0IsQ0FBQyxFQUFFLENBQUM7UUFDbEYsUUFBUSxFQUFFLENBQUMsS0FBWSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLDBCQUFnQixDQUFDLEtBQUssRUFBRSx1QkFBYSxDQUFDLEVBQUUsQ0FBQztRQUM5RSxRQUFRLEVBQUUsQ0FBQyxLQUFZLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsMEJBQWdCLENBQUMsS0FBSyxFQUFFLCtCQUFXLENBQUMsRUFBRSxDQUFDO1FBQzVFLElBQUksRUFBRSxDQUFDLEtBQVksRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSwwQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsdUJBQWEsQ0FBQyxFQUFFLENBQUM7UUFDMUUsSUFBSSxFQUFFLENBQUMsS0FBWSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLDBCQUFnQixDQUFDLEtBQUssRUFBRSxrQ0FBZ0IsQ0FBQyxFQUFFLENBQUM7UUFDN0UsTUFBTSxFQUFFLENBQUMsS0FBa0IsRUFBRSxFQUFFO1lBQzdCLE1BQU0sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBQ3BDLE1BQU0sVUFBVSxHQUFHLDJCQUFpQixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUV4RCxzREFBc0Q7WUFDdEQsZ0VBQWdFO1lBQ2hFLDJFQUEyRTtZQUMzRSxtQ0FBbUM7WUFFbkMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLHFCQUFxQixDQUFDO1lBRWhGLE1BQU0sVUFBVSxHQUFHLEVBQXFCLENBQUM7WUFFekMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRTtnQkFDNUIsVUFBVSxDQUFDLE1BQU0sR0FBRztvQkFDbEIsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsZUFBZTtpQkFDakMsQ0FBQztnQkFFRixVQUFVLENBQUMsY0FBYyxHQUFHO29CQUMxQixJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyx1QkFBdUI7aUJBQ3pDLENBQUM7YUFDSDtZQUVELE1BQU0scUJBQXFCLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQztZQUMvQyxNQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMscUJBQXFCLENBQUMsQ0FBQztZQUVsRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUM7WUFFN0MsTUFBTSxNQUFNLEdBQUc7Z0JBQ2IsSUFBSSxFQUFFLFVBQVU7Z0JBQ2hCLElBQUk7Z0JBQ0osVUFBVSxFQUFFLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRTtnQkFDOUIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU87b0JBQ2pDLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ2pDLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQztvQkFDN0MsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsSUFBSSxPQUFPLENBQUMsY0FBYyxDQUFDO29CQUVyRSxJQUFJLEVBQUUsR0FBRyxLQUFLLENBQUM7b0JBRWYsSUFBSSxFQUFFLEVBQUU7d0JBQ04sRUFBRSxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQzt3QkFFbkIsTUFBTSxvQkFBb0IsR0FBRzs0QkFDM0IsVUFBVSxFQUFFLGlCQUFpQjs0QkFDN0IsS0FBSyxFQUFFO2dDQUNMLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztnQ0FDckIsR0FBRyxFQUFFO29DQUNILE1BQU0sRUFBRSxFQUFFO2lDQUNYOzZCQUNGOzRCQUNELEdBQUcsRUFBRTtnQ0FDSCxHQUFHLE9BQU87Z0NBQ1YsTUFBTTtnQ0FDTixjQUFjOzZCQUNmOzRCQUNELEtBQUssRUFBRSxDQUFDO3lCQUNULENBQUM7d0JBRUYsTUFBTSxlQUFlLEdBQUcsTUFBTSxJQUFJLENBQUMsb0JBQW9CLENBQUMsQ0FBQzt3QkFFekQsSUFBSSxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQzs0QkFBRSxPQUFPLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBRTVELE9BQU8sSUFBSSxDQUFDO3FCQUNiO29CQUVELE9BQU8sSUFBSSxDQUFDO2dCQUNkLENBQUM7YUFDRixDQUFDO1lBRUYsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBRS9ELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHO2dCQUNsQixJQUFJLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixDQUM1QixVQUFVLEVBQ1YsV0FBVyxFQUNYLFVBQVUsQ0FDWDthQUNGLENBQUM7WUFFRixPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDO1FBQ0QsS0FBSyxFQUFFLENBQUMsS0FBaUIsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUM3QixJQUFJLEVBQUUsMEJBQWdCLENBQ3BCLEtBQUssRUFDTCxJQUFJLHlCQUFlLENBQUM7Z0JBQ2xCLElBQUksRUFBRSwyQkFBaUIsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQztnQkFDL0MsTUFBTSxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxFQUFFO29CQUM5QyxJQUFJLHNCQUFjLENBQUMsTUFBTSxDQUFDLEVBQUU7d0JBQzFCLE9BQU87NEJBQ0wsR0FBRyxNQUFNOzRCQUNULENBQUMsb0JBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtnQ0FDMUIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLOzZCQUNwQjt5QkFDRixDQUFDO3FCQUNIO29CQUVELE9BQU87d0JBQ0wsR0FBRyxNQUFNO3dCQUNULENBQUMsb0JBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFOzRCQUNwQixLQUFLLEVBQUUsTUFBTTt5QkFDZDtxQkFDRixDQUFDO2dCQUNKLENBQUMsRUFBRSxFQUFFLENBQUM7YUFDUCxDQUFDLENBQ0g7U0FDRixDQUFDO1FBQ0YsUUFBUSxFQUFFLENBQUMsS0FBWSxFQUFFLEVBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLDBCQUFnQixDQUFDLEtBQUssRUFBRSx3QkFBYyxDQUFDLEVBQUUsQ0FBQztRQUMvRSxNQUFNLEVBQUUsQ0FBQyxLQUFrQixFQUFFLEVBQUU7WUFDN0IsTUFBTSxRQUFRLEdBQUcsMkJBQWlCLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUUzRCxJQUFJLElBQUksR0FBZ0IsSUFBSSx5QkFBZSxDQUFDO2dCQUMxQyxJQUFJLEVBQUUsUUFBUTtnQkFDZCxNQUFNLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLEVBQUU7b0JBQzlDLElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxLQUFLLEVBQUU7d0JBQzlDLE9BQU87NEJBQ0wsR0FBRyxNQUFNOzRCQUNULENBQUMsb0JBQVUsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtnQ0FDMUIsS0FBSyxFQUFFLE1BQU0sQ0FBQyxLQUFLOzZCQUNwQjt5QkFDRixDQUFDO3FCQUNIO29CQUVELElBQUksT0FBTyxNQUFNLEtBQUssUUFBUSxFQUFFO3dCQUM5QixPQUFPOzRCQUNMLEdBQUcsTUFBTTs0QkFDVCxDQUFDLG9CQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRTtnQ0FDcEIsS0FBSyxFQUFFLE1BQU07NkJBQ2Q7eUJBQ0YsQ0FBQztxQkFDSDtvQkFFRCxPQUFPLE1BQU0sQ0FBQztnQkFDaEIsQ0FBQyxFQUFFLEVBQUUsQ0FBQzthQUNQLENBQUMsQ0FBQztZQUVILElBQUksR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLHFCQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNwRCxJQUFJLEdBQUcsMEJBQWdCLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBRXJDLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUNsQixDQUFDO1FBQ0QsWUFBWSxFQUFFLENBQUMsS0FBd0IsRUFBRSxFQUFFO1lBQ3pDLE1BQU0sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBQ3BDLE1BQU0sMEJBQTBCLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUM3RCxNQUFNLGFBQWEsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO1lBQ3BDLE1BQU0sZ0JBQWdCLEdBQUcsMkJBQWlCLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBRTlELElBQUksSUFBSSxDQUFDO1lBQ1QsSUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDO1lBRTFCLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRTtnQkFDN0IsY0FBYyxHQUFHLElBQUkseUJBQWUsQ0FBQztvQkFDbkMsSUFBSSxFQUFFLEdBQUcsZ0JBQWdCLGFBQWE7b0JBQ3RDLE1BQU0sRUFBRSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQzt3QkFDbEQsR0FBRyxTQUFTO3dCQUNaLENBQUMsb0JBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFOzRCQUN0QixLQUFLLEVBQUUsUUFBUTt5QkFDaEI7cUJBQ0YsQ0FBQyxFQUFFLEVBQUUsQ0FBQztpQkFDUixDQUFDLENBQUM7Z0JBRUgsTUFBTSxLQUFLLEdBQUcsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBRXBGLElBQUksV0FBVyxHQUFHLFNBQVMsV0FBVyxDQUFDLElBQUk7b0JBQ3pDLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFDeEQsQ0FBQyxDQUFDO2dCQUVGLFdBQVcsR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUVyQyxJQUFJLEdBQUcsSUFBSSwyQkFBaUIsQ0FBQztvQkFDM0IsSUFBSSxFQUFFLEdBQUcsZ0JBQWdCLGVBQWU7b0JBQ3hDLE1BQU0sRUFBRTt3QkFDTixVQUFVLEVBQUU7NEJBQ1YsSUFBSSxFQUFFLGNBQWM7eUJBQ3JCO3dCQUNELEtBQUssRUFBRTs0QkFDTCxJQUFJLEVBQUUsSUFBSSwwQkFBZ0IsQ0FBQztnQ0FDekIsSUFBSSxFQUFFLGdCQUFnQjtnQ0FDdEIsS0FBSztnQ0FDTCxXQUFXOzZCQUNaLENBQUM7eUJBQ0g7cUJBQ0Y7aUJBQ0YsQ0FBQyxDQUFDO2FBQ0o7aUJBQU07Z0JBQ0wsQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBb0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQzdEO1lBRUQsc0RBQXNEO1lBQ3RELGdFQUFnRTtZQUNoRSwyRUFBMkU7WUFDM0UsbUNBQW1DO1lBRW5DLElBQUksR0FBRyxJQUFJLElBQUkscUJBQXFCLENBQUM7WUFFckMsTUFBTSxnQkFBZ0IsR0FNbEIsRUFBRSxDQUFDO1lBRVAsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksRUFBRTtnQkFDNUIsZ0JBQWdCLENBQUMsTUFBTSxHQUFHO29CQUN4QixJQUFJLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlO2lCQUNqQyxDQUFDO2dCQUVGLGdCQUFnQixDQUFDLGNBQWMsR0FBRztvQkFDaEMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsdUJBQXVCO2lCQUN6QyxDQUFDO2FBQ0g7WUFFRCxNQUFNLEVBQ0osV0FBVyxFQUNYLFVBQVUsRUFBRSxFQUNWLFdBQVcsRUFBRSxFQUNYLElBQUksR0FDTCxHQUNGLEdBQ0YsR0FBRyxJQUFJLENBQUM7WUFFVCxNQUFNLFlBQVksR0FBRztnQkFDbkIsSUFBSSxFQUFFLGdCQUFnQjtnQkFDdEIsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxxQkFBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJO2dCQUNsRCxVQUFVLEVBQUUsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFO2dCQUM5QixLQUFLLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTztvQkFDakMsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDakMsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDO29CQUM3QyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUM7b0JBQ3JFLElBQUkscUJBQXFCLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQztvQkFFN0MsSUFBSSxhQUFhLEVBQUU7d0JBQ2pCLE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQzt3QkFDbkIsTUFBTSxjQUFjLEdBQUcsRUFBRSxDQUFDO3dCQUUxQixNQUFNLHVCQUF1QixHQUFHLEtBQUssRUFBRSxVQUFVLEVBQUUsRUFBRTs0QkFDbkQsSUFBSSxFQUFFLEdBQUcsVUFBVSxDQUFDOzRCQUVwQixJQUFJLDBCQUEwQixFQUFFO2dDQUM5QixxQkFBcUIsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUFDO2dDQUM5QyxFQUFFLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQzs2QkFDdkI7NEJBRUQsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUM7Z0NBQ3hCLFVBQVUsRUFBRSxXQUFXLENBQUMscUJBQStCLENBQUM7Z0NBQ3hELEtBQUssRUFBRTtvQ0FDTCxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUM7b0NBQ3JCLEdBQUcsRUFBRTt3Q0FDSCxNQUFNLEVBQUUsRUFBRTtxQ0FDWDtpQ0FDRjtnQ0FDRCxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUc7Z0NBQ2hCLEdBQUcsRUFBRTtvQ0FDSCxHQUFHLE9BQU8sQ0FBQyxHQUFHO29DQUNkLE1BQU07b0NBQ04sY0FBYztpQ0FDZjtnQ0FDRCxLQUFLLEVBQUUsQ0FBQzs2QkFDVCxDQUFDLENBQUM7NEJBRUgsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0NBQzVCLElBQUksMEJBQTBCLEVBQUU7b0NBQzlCLE9BQU8sQ0FBQyxJQUFJLENBQUM7d0NBQ1gsVUFBVSxFQUFFLHFCQUFxQjt3Q0FDakMsS0FBSyxFQUFFOzRDQUNMLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7NENBQ2pCLFVBQVUsRUFBRSxxQkFBcUI7eUNBQ2xDO3FDQUNGLENBQUMsQ0FBQztpQ0FDSjtxQ0FBTTtvQ0FDTCxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztpQ0FDOUI7NkJBQ0Y7d0JBQ0gsQ0FBQyxDQUFDO3dCQUVGLElBQUksS0FBSyxFQUFFOzRCQUNULEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsRUFBRTtnQ0FDM0IsY0FBYyxDQUFDLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDOzRCQUMzRCxDQUFDLENBQUMsQ0FBQzt5QkFDSjt3QkFFRCxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUM7d0JBQ2xDLE9BQU8sT0FBTyxDQUFDO3FCQUNoQjtvQkFFRCxJQUFJLEVBQUUsR0FBRyxLQUFLLENBQUM7b0JBQ2YsSUFBSSwwQkFBMEIsSUFBSSxLQUFLLEVBQUU7d0JBQ3ZDLEVBQUUsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDO3dCQUNqQixxQkFBcUIsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO3FCQUMxQztvQkFFRCxJQUFJLEVBQUUsRUFBRTt3QkFDTixFQUFFLEdBQUcsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDO3dCQUVuQixNQUFNLG9CQUFvQixHQUFHOzRCQUMzQixVQUFVLEVBQUUsV0FBVyxDQUFDLHFCQUErQixDQUFDOzRCQUN4RCxLQUFLLEVBQUU7Z0NBQ0wsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksRUFBRSxDQUFDO2dDQUNyQixFQUFFLEVBQUU7b0NBQ0YsTUFBTSxFQUFFLEVBQUU7aUNBQ1g7NkJBQ0Y7NEJBQ0QsR0FBRyxPQUFPOzRCQUNWLEtBQUssRUFBRSxDQUFDO3lCQUNULENBQUM7d0JBRUYsSUFBSSxJQUFJLENBQUMsSUFBSTs0QkFBRSxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7d0JBQzlELElBQUksSUFBSSxDQUFDLEtBQUs7NEJBQUUsb0JBQW9CLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO3dCQUVqRSxNQUFNLGVBQWUsR0FBRyxNQUFNLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO3dCQUV6RCxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUU7NEJBQzNCLElBQUksMEJBQTBCLEVBQUU7Z0NBQzlCLE9BQU87b0NBQ0wsVUFBVSxFQUFFLHFCQUFxQjtvQ0FDakMsS0FBSyxFQUFFO3dDQUNMLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7d0NBQzFCLFVBQVUsRUFBRSxxQkFBcUI7cUNBQ2xDO2lDQUNGLENBQUM7NkJBQ0g7NEJBRUQsT0FBTyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO3lCQUNoQzt3QkFFRCxPQUFPLElBQUksQ0FBQztxQkFDYjtvQkFFRCxPQUFPLElBQUksQ0FBQztnQkFDZCxDQUFDO2FBQ0YsQ0FBQztZQUVGLElBQUksYUFBYSxFQUFFO2dCQUNqQixZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxFQUFFLElBQUksRUFBRSxvQkFBVSxFQUFFLENBQUM7Z0JBQzlDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLG9CQUFVLEVBQUUsQ0FBQzthQUNoRDtZQUVELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsRUFBRTtnQkFDN0IsTUFBTSx1QkFBdUIsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUM7b0JBQ3pFLEdBQUcsU0FBUztvQkFDWixHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsTUFBTTtpQkFDdkMsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFFUCxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRztvQkFDeEIsSUFBSSxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FDNUIsZ0JBQWdCLEVBQ2hCLHVCQUF1QixFQUN2QixnQkFBZ0IsQ0FDakI7aUJBQ0YsQ0FBQzthQUNIO2lCQUFNO2dCQUNMLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztnQkFFL0QsWUFBWSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUc7b0JBQ3hCLElBQUksRUFBRSxJQUFJLENBQUMsbUJBQW1CLENBQzVCLGdCQUFnQixFQUNoQixXQUFXLEVBQ1gsZ0JBQWdCLENBQ2pCO2lCQUNGLENBQUM7YUFDSDtZQUVELE9BQU8sWUFBWSxDQUFDO1FBQ3RCLENBQUM7UUFDRCxLQUFLLEVBQUUsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNmLE1BQU0sUUFBUSxHQUFHLDJCQUFpQixDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDNUQsSUFBSSxJQUFJLEdBQUcsd0JBQXdCLENBQUMsUUFBUSxFQUFFLEtBQUssQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDdEUsSUFBSSxHQUFHLElBQUkscUJBQVcsQ0FBQywwQkFBZ0IsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUV0RCxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDbEIsQ0FBQztRQUNELEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ2YsTUFBTSxRQUFRLEdBQUcsMkJBQWlCLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM1RCxNQUFNLElBQUksR0FBRyx3QkFBd0IsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUV4RSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDbEIsQ0FBQztRQUNELE1BQU0sRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ2hCLE1BQU0sVUFBVSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUU7Z0JBQzVDLElBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzNCLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNDLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxJQUFJLEdBQUcsSUFBSSxxQkFBVyxDQUFDLElBQUksMEJBQWdCLENBQUM7Z0JBQ2hELElBQUksRUFBRSwyQkFBaUIsQ0FBQyxVQUFVLEVBQUUsS0FBSyxDQUFDLEtBQUssQ0FBQztnQkFDaEQsS0FBSyxFQUFFLFVBQVU7Z0JBQ2pCLFdBQVcsRUFBRSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQzthQUM3RCxDQUFDLENBQUMsQ0FBQztZQUVKLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUNsQixDQUFDO1FBQ0QsR0FBRyxFQUFFLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGNBQWMsRUFBRSxRQUFRLEVBQUUsRUFBRTtZQUMvRCxNQUFNLGVBQWUsR0FBRyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFeEQsSUFBSSxlQUFlLEVBQUU7Z0JBQ25CLE9BQU87b0JBQ0wsR0FBRyxjQUFjO29CQUNqQixDQUFDLG9CQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsZUFBZSxDQUFDLFFBQVEsQ0FBQztpQkFDdkQsQ0FBQzthQUNIO1lBRUQsT0FBTyxjQUFjLENBQUM7UUFDeEIsQ0FBQyxFQUFFLEVBQUUsQ0FBQztLQUNQLENBQUM7SUFFRixNQUFNLFlBQVksR0FBRztRQUNuQixJQUFJO1FBQ0osTUFBTSxFQUFFLEdBQUcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUU7WUFDNUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUU7Z0JBQ2pCLE1BQU0sV0FBVyxHQUFHLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDakQsSUFBSSxXQUFXLEVBQUU7b0JBQ2YsSUFBSSxLQUFLLENBQUMsSUFBSSxFQUFFO3dCQUNkLE9BQU87NEJBQ0wsR0FBRyxNQUFNOzRCQUNULENBQUMsb0JBQVUsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDO3lCQUM3QyxDQUFDO3FCQUNIO29CQUVELE9BQU87d0JBQ0wsR0FBRyxNQUFNO3dCQUNULEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQztxQkFDdEIsQ0FBQztpQkFDSDthQUNGO1lBRUQsT0FBTyxNQUFNLENBQUM7UUFDaEIsQ0FBQyxFQUFFLFVBQVUsQ0FBQztLQUNmLENBQUM7SUFFRixNQUFNLHFCQUFxQixHQUFHLElBQUksMkJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7SUFFbEUsT0FBTyxxQkFBcUIsQ0FBQztBQUMvQixDQUFDO0FBRUQsa0JBQWUsZUFBZSxDQUFDIn0=